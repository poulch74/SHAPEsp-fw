<html>
   <head>
   <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=2.0'>

   <style  type='text/css'>

      body { font: 100% verdana, arial, sans-serif; background-color: #fff; margin: 10px; }
      form { font: 100% verdana, arial, sans-serif; background-color: #fff; margin: 10px; }

      #tabs { padding: 10px 10px 4px 0px; margin: 0px; clear: both; }
      #tabs-title { padding: 10px 10px 4px 10px; margin: 0px; clear: both; border-bottom: 1px solid #fc0;}

      #tabs-title { background: #fff; height: 20px; font: 12px verdana, arial, sans-serif; }

      .tab-title { border: 1px solid #fc0; cursor: pointer; background: #fc0; margin-right: 3px; padding: 4px 5px; list-style: none; float: left; }

      .selected-li { border-bottom: 1px solid #fff; border-right: 1px solid #fc0; border-left: 1px solid #fc0; border-top: 1px solid #fc0; background: #fff; }

      #tabs-title li:hover { background: #fff; }

      .tab { height: 500px; overflow-y:auto; padding: 1px; display: none; background: #fff; text-align: justify; }
      
      .selected {  height: 500px; display: block; }

      .maintable { width:100%; border-spacing: 0px; border-right: 1px solid #fc0; border-left: 1px solid #fc0;}

      #sidebar { float: left; }

      #container { width: 100%; }

      .ptitle { padding: 3px; }

   .button24 {
   display: inline-block;
   color: white;
   text-decoration: none;
   height: 2em;
   padding: .2em 2em;
   outline: none;
   border-width: 1px 0;
   border-style: solid none;
   border-color: #FFCC00 #000 #D77206;
   border-radius: 4px;
   background: linear-gradient(#F3AE0F, #E38916) #E38916;
   transition: 0.2s;
   }
   .button24:hover { background: linear-gradient(#ffcc00, #f5ae00) #ffcc00; }
   .button24:active { background: linear-gradient(#f59500, #ffcc00) #f59500; }

   input[type="number"] {
       width: 5em;
       height: 2em;
       border-radius: 4px;  
       position: relative;
       border: 1px solid #fc0;
       border-color: #fc0;
       padding: 0 0 0 1em;
   }


   input[type="number"].mod::-webkit-outer-spin-button, 
   input[type="number"].mod::-webkit-inner-spin-button {
      -webkit-appearance: none;
      background: #FFF url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAKUlEQVQYlWNgwAT/sYhhKPiPT+F/LJgEsHv37v+EMGkmkuImoh2NoQAANlcun/q4OoYAAAAASUVORK5CYII=) no-repeat center center;
      width: 1.2em;
      border-left: 1px solid #fc0;
      opacity: .5; /* shows Spin Buttons per default (Chrome >= 39) */
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
   }

   input[type="number"].mod::-webkit-inner-spin-button:hover,
   input[type="number"].mod::-webkit-inner-spin-button:active{
       box-shadow: 0 0 2px #fc0;
       opacity: .8;
   }

   input:-webkit-autofill {
       background: black;
       color: red;
   } 

   .iptext{ height: 2em; padding: 0 1em 0 1em;
           border: 1px solid #fc0; outline: 0; border-radius: 4px; } 

   .itext{ width: 5em; height: 2em; padding: 0 0 0 1em;
           border: 1px solid #fc0; outline: 0; border-radius: 4px;} 

   .ctext{ width: 7em; height: 2em; padding: 0 0 0 1em;
           border: 1px solid #fc0; outline: 0; border-radius: 4px; } 

   .ctext1{ width: 15em; height: 2em; padding: 0 0 0 1em;
           border: 1px solid #fc0; outline: 0; border-radius: 4px; } 

   .div1{display:table;}
   .div2{display:table-row;}
   .div3{display:table-cell; padding: 0 0 5px 10px; font: 12px verdana, arial, sans-serif;}

   </style>
  
   <script type="text/javascript">

      !function(n){'use strict';function t(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}
      function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}
      function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}
      function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}
      function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;
      for(e=0;e<n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),
      g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),
      g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),
      g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),
      g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),
      g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),
      g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),
      g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),
      g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),
      g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),
      g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),
      g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),
      g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),
      g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),
      g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),
      g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),
      g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]}
      function a(n){var t,r='',e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}
      function d(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}
      function h(n){return a(i(d(n),8*n.length))}function l(n,t){var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))}
      function g(n){var t,r,e='';for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),e+='0123456789abcdef'.charAt(t>>>4&15)+'0123456789abcdef'.charAt(15&t);return e}
      function v(n){return unescape(encodeURIComponent(n))}function m(n){return h(v(n))}function p(n){return g(m(n))}
      function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}
      function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}'function'==typeof define&&define.amd?define(function(){return A}):
      'object'==typeof module&&module.exports?module.exports=A:n.md5=A}(this);

      function getRandomInt(max) { return Math.floor(Math.random() * (max-1)) + 1; }

      function fillselect()
      {
        var tl = ['All','MO','TU','WE','TH','FR','SA','SU','Work','SA,SU','Work+SA','MO,WE,FR','TU,TH,SA','MO,TU,WE','TH,FR,SA'];
        var val = ['127','1','2','4','8','16','32','64','31','96','63','21','42','7','56'];
        for(var i=0;i<10;i++)
        {
          var obj = document.getElementById('time_sdmask'+i);
          var obj1 = document.getElementById('time_edmask'+i);
          var sel=true;
          for(var j=0;j<15;j++)
          {
            if(j!=0) sel = false;
            obj.options[j] = new Option(tl[j], val[j], sel);
            obj1.options[j] = new Option(tl[j], val[j], sel);
          }
        }
      }

      function maketable()
      {
         var table = document.getElementById("timer_table"); // Получаем ссылку на таблицу
         for(var i=0;i<10;i++)
         {
            var row = table.insertRow(table.rows.length-1); // Добавляем строку
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            var cell4 = row.insertCell(4);
            var cell5 = row.insertCell(5);
            var cell6 = row.insertCell(6);
            var cell7 = row.insertCell(7);

            cell0.innerHTML = "<span class='div3'>Prg"+i+"</span>";

            var select = document.createElement("select"); // Ввод файла
            select.className = "itext"; select.id = "time_sact"+i;
            select.appendChild(new Option("No", "0"));
            select.appendChild(new Option("Yes", "1"));   
            cell1.appendChild(select);

            var combo1 = document.createElement("select"); // Ввод файла
            combo1.className = "ctext"; combo1.id = "time_sdmask"+i;
            cell2.appendChild(combo1);

            var input1 = document.createElement("input"); // Ввод файла
            input1.className = "mod"; input1.id = "time_shour"+i; input1.type = "number";
            input1.min =  "0"; input1.max = "23"; input1.step = "1";
            input1.value = "0";
            cell3.appendChild(input1);

            var input2 = document.createElement("input"); // Ввод файла
            input2.className = "mod"; input2.id = "time_smin"+i; input2.type = "number";
            input2.min =  "0"; input2.max = "59"; input2.step = "1";
            input2.value = "0";
            cell4.appendChild(input2);

            var combo2 = document.createElement("select"); // Ввод файла
            combo2.className = "ctext";
            combo2.id = "time_edmask"+i;
            cell5.appendChild(combo2);

            var input3 = document.createElement("input"); // Ввод файла
            input3.className = "mod"; input3.id = "time_ehour"+i; input3.type = "number";
            input3.min =  "0"; input3.max = "23"; input3.step = "1";
            input3.value = "0";
            cell6.appendChild(input3);

            var input4 = document.createElement("input"); // Ввод файла
            input4.className = "mod"; input4.id = "time_emin"+i; input4.type = "number";
            input4.min =  "0"; input4.max = "59"; input4.step = "1";
            input4.value = "0";
            cell7.appendChild(input4);
         }
      }


      var websock;

      var handler_array = [onTabStatusHandler,
                           onTabTimerHandler,
                           onTabSettingsHandler,
                           onTabMqttHandler];

      function SelectTab(idx)
      {
         var tabStart = parseInt(sessionStorage.getItem("tabStart"));
         var tabCount = parseInt(sessionStorage.getItem("tabCount"));
         if(idx>tabCount) return;
         for (var i = tabStart; i <=tabCount; i++)
         {
            var _tab = document.getElementById("tab"+i);
            var _tabTitle = document.getElementById("tab-title"+i);
            if (idx != i)
            {
               _tab.setAttribute("class", "tab");
               _tabTitle.setAttribute("class", "tab-title");
            }
            else
            {
               _tab.setAttribute("class", "tab selected");
               _tabTitle.setAttribute("class", "tab-title selected-li");
               handler_array[idx-1](0,"defaults");
            }
         }
      }

      

      function start()
      {
         maketable();
         fillselect();

         websock = new WebSocket("ws://" + window.location.hostname + "/ws");
         websock.onopen = function(evt) { console.log('websock open'); };
         websock.onclose = function(evt) { console.log('websock close'); };
         websock.onerror = function(evt) { console.log(evt); };
         websock.onmessage = onMessageHandler;
         if(sessionStorage.getItem("hash")) {
            makelist();
            makesensor();
            setTimeout(morestatus,100);
            return;
         }
         sessionStorage.setItem("sessionid", getRandomInt(1000000));
         sessionStorage.setItem("tabStart", 1);
         sessionStorage.setItem("tabCount", 1);
      }

      function onMessageHandler(evt)
      {
         console.log(evt);

         var resp = JSON.parse(evt.data);

         if(resp.action == "auth")
         {
            if(resp.status_auth=='ok')
            {
               makelist();
               setTimeout(morestatus,100);
               document.getElementById('description').innerHTML = "status ok";
            }
            else 
            {
               sessionStorage.removeItem("hash");
               sessionStorage.removeItem("sensCount");
               sessionStorage.setItem("sessionid", getRandomInt(1000000));
               sessionStorage.setItem("tabStart", 1);
               sessionStorage.setItem("tabCount", 1);
               window.location.reload();
             }
             return;
         }

         if((resp.action == "senscnt"))
         {
            sessionStorage.setItem("sensCount", resp.sens_cnt);
            makesensor();
            return;
         }

         if((resp.action == "time") || (resp.action == "wifi") || (resp.action == "mqtt"))
         {
            var resp = JSON.parse(evt.data,function(key,value){
               if(document.getElementById(key)!=null) document.getElementById(key).value = value;
               return value;
            });
            return;
         }

         var resp = JSON.parse(evt.data,function(key,value){
            if(key!='action' && key!='')
               if(document.getElementById(key)!=null) document.getElementById(key).innerHTML = value;
            return value;
         });

      };

      function reqauth(f)
      {
         var paswd = document.getElementById('pwd').value; document.getElementById('pwd').value = '';
         var user = document.getElementById('un').value; document.getElementById('un').value = '';
         var d = "0";
         var hash;
         if(sessionStorage.getItem("sessionid"))
         {
            d = sessionStorage.getItem("sessionid");
            hash = md5(user+paswd+d);
            sessionStorage.setItem("hash", hash);
            document.getElementById('description').innerHTML = hash;
            var msg = { type: "message", auth : hash, text: "sessionid", data : d};
            var smsg = JSON.stringify(msg);
            websock.send(smsg);
         }
         return false;
      }

      function morestatus()
      {
         var msg;
         var tout;
         if(sessionStorage.getItem("sensCount"))
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "status", id: 0 };
            tout=1000;
         }
         else
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "senscnt", id: 0 };
            tout=100;
         }
         var smsg = JSON.stringify(msg);
         websock.send(smsg);
         setTimeout(morestatus, tout);
      }

      function makesensor()
      {
         var div = document.getElementById("tab1div1");
         var temp="";
         var sensCount = parseInt(sessionStorage.getItem("sensCount"));
         for(var i=0;i<sensCount;i++)
         {
            temp += "<div class='div2'><div class='div3'><span id='tsensor_"+i+"'>Sensor"+i+":</span></div><div class='div3'><span id='vsensor_"+i+"'>N/A</span></div></div>";
         }
         div.innerHTML = temp;
      }      

      function onTabStatusHandler(_id,_cmd) {}

      // defaults
      // settime settimer savetimer clearall
      function onTabTimerHandler(_id,_cmd)
      {
         var msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "time", id: _id };
         if((_cmd=="defaults") || (_cmd=="open") || (_cmd=="close") || (_cmd=="auto"))
         {
            msg['cmd'] = _cmd;
         }

         if(_cmd=="settime")
         {
             msg['cmd'] = _cmd;
             msg['time_year'] =  document.getElementById("time_year").value;
             msg['time_month'] =  document.getElementById("time_month").value;
             msg['time_day'] =  document.getElementById("time_day").value;
             msg['time_dow'] =  document.getElementById("time_dow").value;
             msg['time_hour'] =  document.getElementById("time_hour").value;
             msg['time_min'] =  document.getElementById("time_min").value;
             msg['time_sec'] =  document.getElementById("time_sec").value;

         }

         if(_cmd=="settimer" || _cmd=="savetimer" || _cmd=="resettimer")
         {
            msg['cmd'] = _cmd;
            for(var i=0;i<10;i++)
            {
               msg['time_sact'+i] = document.getElementById('time_sact'+i).value;
               msg['time_sdmask'+i] = document.getElementById('time_sdmask'+i).value;
               msg['time_shour'+i] = document.getElementById('time_shour'+i).value;
               msg['time_smin'+i] = document.getElementById('time_smin'+i).value;
               msg['time_edmask'+i] = document.getElementById('time_edmask'+i).value;
               msg['time_ehour'+i] = document.getElementById('time_ehour'+i).value;
               msg['time_emin'+i] = document.getElementById('time_emin'+i).value;
            }               
         }            

         websock.send(JSON.stringify(msg));

         document.getElementById('description').innerHTML = JSON.stringify(msg);
      }


      function onTabSettingsHandler(_id,_cmd)
      {
         var msg;

         if(_cmd=="defaults")
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "wifi", cmd: _cmd, id: _id };
         }

         if(_cmd=="setwifi")
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "wifi", cmd: _cmd, id: _id};

            var IPvalue = document.getElementById('wifi_ipa').value;
            var GWvalue = document.getElementById('wifi_gw').value;

            var pattern = /(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})\.(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})\.(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})\.(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})/;

            var ipArray = IPvalue.match(pattern);
            var gwArray = GWvalue.match(pattern);
            if(ipArray==null) { alert('Invalid IP address!!!'); return; }
            if(gwArray==null) { alert('Invalid GW address!!!'); return; }

            msg['wifi_ssid'] =  document.getElementById('wifi_ssid').value;
            msg['wifi_pwd'] =  document.getElementById('wifi_pwd').value;
            msg['wifi_dhcp'] =  document.getElementById('wifi_dhcp').value;
            msg['wifi_ipa'] =  IPvalue;
            msg['wifi_gw'] =  GWvalue;
            msg['wifi_mask'] =  document.getElementById('wifi_mask').value;
            msg['wifi_tnet'] =  document.getElementById('wifi_tnet').value;
         }

         websock.send(JSON.stringify(msg));

         document.getElementById('description').innerHTML = JSON.stringify(msg);
      }

      function onTabMqttHandler(_id,_cmd)
      {
         var msg;

         if(_cmd=="defaults")
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "mqtt", cmd: _cmd, id: _id };
         }

         if(_cmd=="setmqtt")
         {
            msg = { type: "message", auth: sessionStorage.getItem("hash"), text: "mqtt", cmd: _cmd, id: _id};

            msg['mqtt_vcc'] = document.getElementById('mqtt_vcc').value;
            msg['mqtt_status'] = document.getElementById('mqtt_status').value;
            msg['mqtt_mode'] = document.getElementById('mqtt_mode').value;
         }

         websock.send(JSON.stringify(msg));

         document.getElementById('description').innerHTML = JSON.stringify(msg);
      }


      function makelist()
      {
         sessionStorage.setItem("tabCount",4);
         var list = document.getElementById("tabs-title");
         list.innerHTML = "<li id='tab-title1' onclick='SelectTab(1);' class='tab-title selected-li'>Status</li> \
                           <li id='tab-title2' onclick='SelectTab(2);' class='tab-title'>Timer</li> \
                           <li id='tab-title3' onclick='SelectTab(3);' class='tab-title'>Settings</li> \
                           <li id='tab-title4' onclick='SelectTab(4);' class='tab-title'>MQTT</li>";

         var _tab = document.getElementById("tab0");
         _tab.setAttribute("class", "tab");

         _tab = document.getElementById("tab1");
         _tab.setAttribute("class", "tab selected");
      }

   </script>

   </head>

   <body onload="javascript:start();">

   <table class="maintable">

      <tr><td bgcolor='#fc0' style='height:2em; padding:0 0 0 1em' align='left'>SHAPEsp timer v1.0</td></tr>

      <tr>
         <td>
            <ul id="tabs-title">
               <li id="tab-title0" class="tab-title selected-li">Logon</li>
            </ul>

            <div id="tabs">

            <div class="tab selected" id="tab0">
               <form name='logf' method='POST' onsubmit='return reqauth(this);'>
                  <table>
                     <tr>
                        <td align='right'><span class = 'div3'>User:</span></td>
                        <td align='centre'><input type='text' class='ctext1' name='USERNAME' id='un' maxlength='20' placeholder='user name'></td>
                     </tr>
                     <tr>
                        <td align='right'><span class = 'div3'>Password:</span></td>
                        <td align='center'><input type='password' class='ctext1' name='PASSWORD' id='pwd' maxlength='20' placeholder='password'></td>
                     </tr>
                     <tr>
                        <td></td>
                        <td style='height:2em' align='center'><input type='submit' class='button24' name='SUBMIT' value='Login'></td>
                     </tr>
                  </table>
               </form>
            </div>

            <div class='tab' id='tab1'>
               <div class='div1'>
                  <div class='div2'>
                     <div class='div3'>Date:</div>
                     <div class='div3'><span id="status_date">1</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Time:</div>
                     <div class='div3'><span id="status_time">1</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Uptime:</div>
                     <div class='div3'><span id="status_uptime">1</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Free Heap :</div>
                     <div class='div3'><span id="status_heap">1</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>WIFI mode:</div>
                     <div class='div3'><span id="status_wifimode">5</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>SSID:</div>
                     <div class='div3'><span id="status_wifissid">6</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>IP:</div>
                     <div class='div3'><span id="status_wifiip">7</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>RSSI:</div>
                     <div class='div3'><span id="status_wifirssi">9</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Voltage:</div>
                     <div class='div3'><span id="status_voltage">9</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Valve mode:</div>
                     <div class='div3'><span id="status_vmode">10</span></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Valve status:</div>
                     <div class='div3'><span id="status_vstatus">11</span></div>
                  </div>

                  <div class='div2'>
                     <div class='div3'> <button class='button24' onclick='onTabTimerHandler(0,"open")'>Open</button></div>
                     <div class='div3'> <button class='button24' onclick='onTabTimerHandler(0,"close")'>Close</button></div>
                     <div class='div3'> <button class='button24' onclick='onTabTimerHandler(0,"auto")'>Auto</button></div>
                  </div>
               </div>
               <div><span>&nbsp</span></div>
               <div class='div1' id='tab1div1'>
                  <!-- senors adds here-->
               </div>
            </div>

            <div class='tab' id='tab2'>
               <div class='div1'>
                  <div class='div2'> 
                     <div class='div3'></div>
                     <div class='div3'>Year</div>
                     <div class='div3'>Month</div>
                     <div class='div3'>Day</div>
                     <div class='div3'>DoW</div>
                     <div class='div3'>Hour</div>
                     <div class='div3'>Min</div>
                     <div class='div3'>Sec</div> 
                     <div class='div3'></div>
                  </div>
                  <div class='div2'>
                     <div class='div3'>Time:</div>
                     <div class='div3'> <input class='mod' type='number' id='time_year' name='year' min='2000' max='2032' step='1' value ='2017'> </div>
                     <div class='div3'> <input class='mod' type='number' id='time_month' name='month' min='1' max='12' step='1' value ='1'> </div>
                     <div class='div3'> <input class='mod' type='number' id='time_day' name='day' min='1' max='31' step='1' value ='1'> </div>
                     <div class='div3'>
                     <select class=itext id='time_dow' name='dow'>
                        <option selected value='1'>Mon</option>
                        <option value='2'>Tue</option>
                        <option value='3'>Wen</option>
                        <option value='4'>Thu</option>
                        <option value='5'>Fri</option>
                        <option value='6'>Sat</option>
                        <option value='7'>Sun</option>
                     </select>
                     </div>
                     <div class='div3'> <input class='mod' type='number' id='time_hour' name='hour' min='0' max='23' step='1' value ='0'> </div>
                     <div class='div3'> <input class='mod' type='number' id='time_min' name='min' min='0' max='59' step='1' value ='0'> </div>
                     <div class='div3'> <input class='mod' type='number' id='time_sec' name='sec' min='0' max='59' step='1' value ='0'> </div>
                     <div class='div3'> <button class='button24' onclick='onTabTimerHandler(0,"settime")'>Set</button></div>
                  </div>
               </div>

               <table id='timer_table'>
                  <tr> 
                     <td><span class = 'div3'></span></td> 
                     <td><span class = 'div3'>Active</span></td> 
                     <td><span class = 'div3'>sDoW</span></td> 
                     <td><span class = 'div3'>sHour</span></td> 
                     <td><span class = 'div3'>sMin</span></td>
                     <td><span class = 'div3'>eDoW</span></td>
                     <td><span class = 'div3'>eHour</span></td>
                     <td><span class = 'div3'>eMin</span></td>
                   </tr>

               <!--
                  <tr><td>Prg0:</td>
                  <td><select class='itext' id=  'sact0'><option selected value='0'>No</option><option value='1'>Yes</option></select></td>
                  <td><select class='ctext' id='sdmask0'></select></td>
               
                  <td> <input class='mod'   id= 'shour0' type='number' min='0' max='23' step='1' value ='0'> </td>
                  <td> <input class='mod'   id=  'smin0' type='number' min='0' max='59' step='1' value ='0'> </td>
                 
                  <td><select class='ctext' id='edmask0'></select></td>
               
                  <td> <input class='mod'   id= 'ehour0' type='number' min='0' max='23' step='1' value ='0'> </td>
                  <td> <input class='mod'   id=  'emin0' type='number'min='0' max='59' step='1' value ='0'> </td>
                  </tr>
                  Тут скриптом 10 записей
               -->
                  <tr>
                  <td></td>
                  <td><button class='button24' id= 'sbtn12' onclick='onTabTimerHandler(0,"settimer")'>Set</button></td>
                  <td><button class='button24' id= 'sbtn10' onclick='onTabTimerHandler(0,"savetimer")'>Save</button></td>
                  <td></td><td></td>
                  <td><button class='button24' id= 'sbtn11' onclick='onTabTimerHandler(0,"resettimer")'>Reset</button></td>
                  <td></td><td></td></tr>
               </table>
            </div>

            <div class='tab' id='tab3'>
               <div class='div1'>

                  <div class='div2'>
                     <div class='div3'>SSID:</div>
                     <div class='div3'>
                        <input type='text' class = 'iptext' name='n_ssid' id='wifi_ssid' value='DIR-300'>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>PWD:</div>
                     <div class='div3'>
                        <input type='text' class = 'iptext' name='n_pwd' id='wifi_pwd' value=''>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>DHCP:</div>
                     <div class='div3'>
                        <select class = 'iptext' id='wifi_dhcp' name='n_dhcp'>
                           <option value='0'>No</option>
                           <option selected value='1'>Yes</option>
                        </select>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>IP address:</div>
                     <div class='div3'>
                        <input type='text' class = 'iptext' name='nipa' id='wifi_ipa' required value ='' title = 'Input ip address d.d.d.d'>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>Gateway:</div>
                     <div class='div3'>
                        <input type='text' class = 'iptext' name='ngw' id='wifi_gw' required value ='' title = 'Input gateway address d.d.d.d'>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>Subnet:</div>
                     <div class='div3'>
                        <select class = 'iptext' id='wifi_mask' name='nmask'>
                           <option selected value='24'>&nbsp/24</option>
                           <option value='23'>&nbsp/23</option>
                           <option value='22'>&nbsp/22</option>
                           <option value='21'>&nbsp/21</option>
                           <option value='20'>&nbsp/20</option>
                           <option value='19'>&nbsp/19</option>
                           <option value='18'>&nbsp/18</option>
                           <option value='17'>&nbsp/17</option>
                           <option value='16'>&nbsp/16</option>
                        </select>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'>Trusted Net:</div>
                     <div class='div3'>
                        <select class = 'iptext' id='wifi_tnet' name='n_tnet'>
                           <option selected value='0'>No</option>
                           <option value='1'>Yes</option>
                        </select>
                     </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'></div>
                     <div class='div3'>
                        <button class=button24 onclick='onTabSettingsHandler(0,"setwifi")'>Apply</button>
                     </div>
                  </div>

               </div>
            </div>

            <div class="tab" id="tab4">
               <div class='div1'>

                  <div class='div2'>
                     <div class='div3'>Vcc IDX:</div>
                     <div class='div3'>
                        <input type='text' class = 'iptext' name='_mqtt_vcc' id='mqtt_vcc' value='N/A'>
                     </div>
                  </div>

                  <div class='div2'>
                        <div class='div3'>Status IDX:</div>
                        <div class='div3'>
                           <input type='text' class = 'iptext' name='_mqtt_status' id='mqtt_status' value='N/A'>
                        </div>
                  </div>

                  <div class='div2'>
                        <div class='div3'>Mode IDX:</div>
                        <div class='div3'>
                           <input type='text' class = 'iptext' name='_mqtt_mode' id='mqtt_mode' value='N/A'>
                        </div>
                  </div>

                  <div class='div2'>
                     <div class='div3'></div>
                        <div class='div3'>
                           <button class=button24 onclick='onTabMqttHandler(0,"setmqtt")'>Apply</button>
                        </div>
                  </div>
   
               </div>
            </div>

            </div>

         </td>
      </tr>

      <tr>
         <td bgcolor='#fc0' style='height:2em; padding:0 0 0 1em' align='left'>&nbsp</td>
      </tr>
   </table>  

   <p id='description'> - </p>

   </body>
</html>